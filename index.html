<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸƒâ€â™‚ï¸ Burning ğŸ”¥</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --main:#27B2A5;
      --accent:#FF6363;
      --bg:#D4F0ED;
      --sub:#FFC1C1;
      --text:#7F7F7F;
    }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family:'Nanum Gothic',system-ui,sans-serif; background:var(--bg); color:var(--text); }
    header{ padding:14px; background:var(--main); color:white; text-align:center; font-weight:700; font-size:18px; }
    .container{ padding:12px; }
    .card{ background:white; border-radius:16px; padding:14px; margin-bottom:14px; box-shadow:0 6px 14px rgba(0,0,0,.06); }
    h1{ margin:4px 0 8px; font-size:22px; color:#333; }
    h2{ margin:0 0 10px; font-size:15px; color:#333; }

    .summary-bar{ display:flex; height:10px; border-radius:6px; overflow:hidden; margin-top:6px; }
    .legend{ display:flex; flex-wrap:wrap; gap:6px 10px; margin-top:8px; font-size:12px; }
    .dot{ width:10px; height:10px; border-radius:50%; display:inline-block; }

    button{ background:var(--main); color:white; border:none; border-radius:12px; padding:12px; font-size:14px; width:100%; }
    button.small{ width:auto; padding:6px 10px; font-size:12px; }

    .form{ display:none; margin-top:10px; }
    .form input,.form select{ width:100%; padding:10px; margin-bottom:8px; border-radius:10px; border:1px solid #ddd; }

    .calendar{ display:grid; grid-template-columns:repeat(7,1fr); gap:6px; }
    .day{ border:1px solid #ddd; border-radius:10px; padding:6px 2px; font-size:12px; text-align:center; }
    .kcal{ font-size:11px; color:var(--main); }

    canvas{ max-height:110px; }

    .goal-status{ display:flex; justify-content:space-between; text-align:center; }
    .goal-item{ flex:1; }
    .goal-item div:first-child{ font-size:13px; }
    .goal-item div:last-child{ font-size:16px; }
  </style>
</head>
<body>
<header>ğŸƒâ€â™‚ï¸ Burning ğŸ”¥</header>
<div class="container">

  <!-- ì›” ìš”ì•½ -->
  <div class="card">
    <h2 id="monthTitle"></h2>
    <h1 id="monthTotal"></h1>
    <div class="summary-bar" id="summaryBar"></div>
    <div class="legend" id="legend"></div>
    <p id="goalText" style="margin-top:14px;font-size:16px;font-weight:700"></p>
  </div>

  <!-- ìš´ë™ ê¸°ë¡ -->
  <div class="card">
    <button onclick="toggleForm()">ìš´ë™ ê¸°ë¡í•˜ê¸°</button>
    <div class="form" id="form">
      <input type="date" id="date" />
      <select id="exercise">
        <option>ìˆ˜ì˜</option>
        <option>ë‹¬ë¦¬ê¸°</option>
        <option>ëŸ°ë‹ë¨¸ì‹ </option>
        <option>ê±·ê¸°</option>
        <option>ì›¨ì´íŠ¸ íŠ¸ë ˆì´ë‹</option>
      </select>
      <input type="number" id="calorie" placeholder="ì¹¼ë¡œë¦¬ (kcal)" />
      <input type="number" id="time" placeholder="ìš´ë™ ì‹œê°„ (ë¶„)" />
      <button onclick="addRecord()">ê¸°ë¡ ì¶”ê°€</button>
    </div>
  </div>

  <!-- ë‚ ì§œë³„ -->
  <div class="card">
    <h2>ë‚ ì§œë³„ë¡œ ë³´ê¸°</h2>
    <div class="calendar" id="calendar"></div>
  </div>

  <!-- ì¢…ëª©ë³„ -->
  <div class="card">
    <h2>ì¢…ëª©ë³„ë¡œ ë³´ê¸°</h2>
    <canvas id="lineChart"></canvas>
  </div>

  <!-- ëª©í‘œ -->
  <div class="card">
    <h2>ëª©í‘œ ë‹¬ì„± í˜„í™©</h2>
    <div class="goal-status" id="goalStatus"></div>
  </div>

</div>

<script>
const records = JSON.parse(localStorage.getItem('exerciseRecords')||'[]');
const monthTitle=document.getElementById('monthTitle');
const monthTotal=document.getElementById('monthTotal');
const summaryBar=document.getElementById('summaryBar');
const legend=document.getElementById('legend');
const calendar=document.getElementById('calendar');
const goalText=document.getElementById('goalText');
const goalStatus=document.getElementById('goalStatus');
const form=document.getElementById('form');

const colors={
  ìˆ˜ì˜:'#27B2A5',
  ë‹¬ë¦¬ê¸°:'#FF6363',
  ëŸ°ë‹ë¨¸ì‹ :'#D4F0ED',
  ê±·ê¸°:'#FFC1C1',
  'ì›¨ì´íŠ¸ íŠ¸ë ˆì´ë‹':'#f59e0b'
};

let viewDate=new Date();
let chart;

function toggleForm(){
  form.style.display=form.style.display==='block'?'none':'block';
}

function addRecord(){
  const d=document.getElementById('date').value;
  const e=document.getElementById('exercise').value;
  const c=Number(document.getElementById('calorie').value);
  const t=Number(document.getElementById('time').value);
  if(!d||!e||!c||!t) return alert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
  records.push({date:d,exercise:e,calorie:c,time:t});
  localStorage.setItem('exerciseRecords',JSON.stringify(records));
  form.reset?.();
  render();
}

function renderGoalStatus(){
  goalStatus.innerHTML='';
  const now=new Date();
  const nowKey=`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
  for(let m=0;m<4;m++){
    const key=`${now.getFullYear()}-${String(m+1).padStart(2,'0')}`;
    const total=records.filter(r=>r.date.startsWith(key)).reduce((a,b)=>a+b.calorie,0);
    let icon='';
    if(key===nowKey) icon='â³';
    else if(key<nowKey) icon=total>=6000?'âœ…':'âŒ';
    const item=document.createElement('div');
    item.className='goal-item';
    item.innerHTML=`<div>${m+1}ì›”</div><div>${icon}</div>`;
    goalStatus.appendChild(item);
  }
}

function render(){
  const y=viewDate.getFullYear();
  const m=viewDate.getMonth();
  const key=`${y}-${String(m+1).padStart(2,'0')}`;
  let total=0,map={},dayMap={};
  records.forEach(r=>{
    if(r.date.startsWith(key)){
      total+=r.calorie;
      map[r.exercise]=(map[r.exercise]||0)+r.calorie;
      dayMap[r.date]=(dayMap[r.date]||0)+r.calorie;
    }
  });
  monthTitle.innerText=`${m+1}ì›” ì´ ìš´ë™ ì¹¼ë¡œë¦¬`;
  monthTotal.innerText=total+' kcal';
  const diff=6000-total;
  goalText.innerHTML=diff>0?
    `6,000kcal ë‹¬ì„±ê¹Œì§€ <span style="color:var(--accent)">${diff}kcal</span> ë‚¨ì•˜ì–´ìš”!`:
    `ì§ì§ì§! <span style="color:#01888C">${Math.abs(diff)}kcal</span> ë” íƒœì› ì–´ìš” ğŸ‰`;

  summaryBar.innerHTML=''; legend.innerHTML='';
  Object.keys(map).forEach(k=>{
    const bar=document.createElement('div');
    bar.style.width=total?(map[k]/total*100)+'%':'0%';
    bar.style.background=colors[k];
    summaryBar.appendChild(bar);
    legend.innerHTML+=`<span><i class="dot" style="background:${colors[k]}"></i>${k} ${map[k]}kcal</span>`;
  });

  if(chart) chart.destroy();
  chart=new Chart(document.getElementById('lineChart'),{
    type:'line',
    data:{labels:Object.keys(map),datasets:[{data:Object.values(map),borderColor:'#27B2A5',tension:.4,pointRadius:4}]},
    options:{plugins:{legend:{display:false}},scales:{x:{display:true},y:{display:false}}}
  });

  calendar.innerHTML='';
  const days=new Date(y,m+1,0).getDate();
  for(let i=1;i<=days;i++){
    const d=`${key}-${String(i).padStart(2,'0')}`;
    calendar.innerHTML+=`<div class="day">${i}<br><span class="kcal">${dayMap[d]||''}</span></div>`;
  }

  renderGoalStatus();
}

render();
</script>
</body>
</html>
