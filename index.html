<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸƒâ€â™‚ï¸ MH Burning ğŸ”¥</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{--main:#27B2A5;--accent:#FF6363;--bg:#D4F0ED;--sub:#FFC1C1}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:var(--bg);color:#7F7F7F}
    header{padding:14px;background:var(--main);color:#fff;text-align:center;font-weight:700}
    .container{padding:12px}
    .card{background:#fff;border-radius:16px;padding:14px;margin-bottom:14px;box-shadow:0 6px 14px rgba(0,0,0,.06)}
    h1{margin:4px 0 8px;font-size:22px}
    h2{margin:0 0 8px;font-size:15px}
    .summary-bar{display:flex;height:10px;border-radius:6px;overflow:hidden;margin-top:6px}
    .legend{display:flex;flex-wrap:wrap;gap:6px 10px;margin-top:8px;font-size:12px}
    .dot{width:10px;height:10px;border-radius:50%;display:inline-block}
    .btn{display:block;width:100%;padding:12px;border:none;border-radius:12px;background:var(--accent);color:#fff;font-size:15px;font-weight:700;margin-bottom:14px}
    .calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .day{border:1px solid #ddd;border-radius:10px;padding:6px 2px;font-size:12px;text-align:center;cursor:pointer}
    .delete-btn{padding:4px 8px;border-radius:6px;background:var(--accent);color:#fff;font-size:12px;cursor:pointer;border:none}
    .kcal{font-size:11px;color:var(--main)}
    .month-nav{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .nav-btn{padding:4px 8px;border-radius:6px;background:var(--main);color:#fff;font-size:12px;cursor:pointer}
    canvas{max-height:120px}
    .goal-row{display:flex;justify-content:space-around;text-align:center}
    .goal-icon{font-size:14px;margin-top:4px}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;z-index:10}
    .modal.active{display:flex}
    .modal-card{background:#fff;border-radius:16px;padding:16px;width:90%;max-width:360px}
    .field{margin-bottom:10px}
    .field label{font-size:13px;display:block;margin-bottom:4px}
    .field input,.field select{width:100%;padding:8px;border-radius:8px;border:1px solid #ccc;font-size:14px}
    .row{display:flex;gap:8px}
    .row .btn{margin-bottom:0}
  </style>
</head>
<body>
<header>ğŸƒâ€â™‚ï¸ MH Burning ğŸ”¥</header>
<div class="container">

  <div class="card">
    <h2 id="monthTitle"></h2>
    <h1 id="monthTotal"></h1>
    <div class="summary-bar" id="summaryBar"></div>
    <div class="legend" id="legend"></div>
    <p id="goalText" style="margin-top:14px;font-size:13px;font-weight:700"></p>
  </div>

  <button class="btn" onclick="openForm()">ìš´ë™ ê¸°ë¡í•˜ê¸°</button>

  <div class="card">
    <h2>ë‚ ì§œë³„ë¡œ ë³´ê¸°</h2>
    <div class="month-nav">
      <span class="nav-btn" onclick="changeMonth(-1)">â—€</span>
      <span id="calMonth"></span>
      <span class="nav-btn" onclick="changeMonth(1)">â–¶</span>
    </div>
    <div class="calendar" id="calendar"></div>
  </div>

  <div class="card">
    <h2>ì¢…ëª©ë³„ë¡œ ë³´ê¸°</h2>
    <div class="month-nav">
      <span class="nav-btn" onclick="changeMonth(-1)">â—€</span>
      <span id="chartMonth"></span>
      <span class="nav-btn" onclick="changeMonth(1)">â–¶</span>
    </div>
    <canvas id="lineChart"></canvas>
  </div>

  <div class="card">
    <h2>ëª©í‘œ ë‹¬ì„± í˜„í™©</h2>
    <div class="goal-row" id="goalStatus"></div>
  </div>
</div>

<div class="modal" id="formModal">
  <div class="modal-card">
    <h2>ìš´ë™ ê¸°ë¡</h2>
    <div class="field">
      <label>ë‚ ì§œ</label>
      <input type="date" id="fDate" />
    </div>
    <div class="field">
      <label>ìš´ë™ ì¢…ëª©</label>
      <select id="fType">
        <option>ìˆ˜ì˜</option>
        <option>ëŸ°ë‹ë¨¸ì‹ </option>
        <option>ìŠ¤í…Œì–´ í´ë¼ì´ë¨¸</option>
        <option>ì›¨ì´íŠ¸ íŠ¸ë ˆì´ë‹</option>
        <option>ê±·ê¸°</option>
        <option>ë“±ì‚°</option>
      </select>
    </div>
    <div class="field">
      <label>ì¹¼ë¡œë¦¬ (kcal)</label>
      <input type="number" id="fKcal" />
    </div>
    <div class="field">
      <label>ìš´ë™ ì‹œê°„ (ë¶„)</label>
      <input type="number" id="fMin" />
    </div>
    <div class="row">
      <button class="btn" onclick="addRecord()">ê¸°ë¡ ì¶”ê°€</button>
      <button class="btn" style="background:#ccc;color:#333" onclick="closeForm()">ì·¨ì†Œ</button>
    </div>
  </div>
</div>

<!-- ë‚ ì§œ ìƒì„¸ ëª¨ë‹¬ -->
<div class="modal" id="detailModal">
  <div class="modal-card">
    <h2 id="detailTitle"></h2>
    <div id="detailList"></div>
    <div class="row" style="margin-top:10px">
      <button class="btn" style="background:#ccc;color:#333" onclick="closeDetail()">ë‹«ê¸°</button>
    </div>
  </div>
</div>

<script>
let records = JSON.parse(localStorage.getItem('exerciseRecords')||'[]');
let viewDate=new Date();
const colors={
  ìˆ˜ì˜:'#27B2A5',
  ëŸ°ë‹ë¨¸ì‹ :'#FF6363',
  'ìŠ¤í…Œì–´ í´ë¼ì´ë¨¸':'#8b5cf6',
  'ì›¨ì´íŠ¸ íŠ¸ë ˆì´ë‹':'#f59e0b',
  ê±·ê¸°:'#FFC1C1',
  ë“±ì‚°:'#22c55e'
};
let chart;

function save(){localStorage.setItem('exerciseRecords',JSON.stringify(records));}

function openForm(){
  fDate.value=new Date().toISOString().slice(0,10);
  fType.value='ìˆ˜ì˜';
  fKcal.value='';
  fMin.value='';
  formModal.classList.add('active');
}
function closeForm(){formModal.classList.remove('active');}

function addRecord(){
  const date=fDate.value;
  const type=fType.value;
  const kcal=Number(fKcal.value);
  const min=Number(fMin.value);
  if(!date||!kcal||!min) return alert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”');
  records.push({id:Date.now(),date,exercise:type,calorie:kcal,minute:min});
  save();closeForm();render();
}

function changeMonth(d){viewDate.setMonth(viewDate.getMonth()+d);render();}

function render(){
  const y=viewDate.getFullYear();
  const m=viewDate.getMonth();
  const key=`${y}-${String(m+1).padStart(2,'0')}`;
  calMonth.innerText=chartMonth.innerText=`${m+1}ì›”`;

  let total=0,map={},dayMap={};
  records.forEach(r=>{
    if(r.date.startsWith(key)){
      total+=r.calorie;
      map[r.exercise]=(map[r.exercise]||0)+r.calorie;
      dayMap[r.date]=(dayMap[r.date]||0)+r.calorie;
    }
  });

  monthTitle.innerText=`${m+1}ì›” ì´ ìš´ë™ ì¹¼ë¡œë¦¬`;
  monthTotal.innerText=total+' kcal';

  const diff=6000-total;
  goalText.innerHTML=diff>0
    ? `6,000kcal ë‹¬ì„±ê¹Œì§€ <span style="color:#FF6363">${diff}kcal</span> ë‚¨ì•˜ì–´ìš”!`
    : `ì§ì§ì§! <span style="color:#01888C">${Math.abs(diff)}kcal</span> ë” íƒœì› ì–´ìš” ğŸ‰`;

  summaryBar.innerHTML='';legend.innerHTML='';
  Object.keys(map).forEach(k=>{
    const bar=document.createElement('div');
    bar.style.width=total?(map[k]/total*100)+'%':'0%';
    bar.style.background=colors[k];
    summaryBar.appendChild(bar);
    legend.innerHTML+=`<span><i class="dot" style="background:${colors[k]}"></i>${k} ${map[k]}kcal</span>`;
  });

  calendar.innerHTML='';
  const days=new Date(y,m+1,0).getDate();
  for(let i=1;i<=days;i++){
    const d=`${key}-${String(i).padStart(2,'0')}`;
    const dayDiv=document.createElement('div');
    dayDiv.className='day';
    dayDiv.innerHTML=`${i}<br><span class="kcal">${dayMap[d]||''}</span>`;
    dayDiv.onclick=()=>openDayDetail(d);
    calendar.appendChild(dayDiv);
  }

  renderChart(map);
  renderGoalStatus();
}

function openDayDetail(date){
  detailTitle.innerText=date+' ìš´ë™ ê¸°ë¡';
  detailList.innerHTML='';
  const list=records.filter(r=>r.date===date);
  if(!list.length){detailList.innerHTML='<p>ê¸°ë¡ ì—†ìŒ</p>';} 
  list.forEach(r=>{
    const div=document.createElement('div');
    div.style.marginBottom='6px';
    div.innerHTML=`${r.exercise} ${r.calorie}kcal <button class="delete-btn" onclick="deleteRecord(${r.id})">ì‚­ì œ</button>`;
    detailList.appendChild(div);
  });
  detailModal.classList.add('active');
}

function closeDetail(){detailModal.classList.remove('active');}

function deleteRecord(id){
  if(!confirm('ì‚­ì œí• ê¹Œìš”?')) return;
  records=records.filter(r=>r.id!==id);
  save();closeDetail();render();
}

function renderChart(map){
  const ctx=lineChart;
  if(chart) chart.destroy();
  chart=new Chart(ctx,{
    type:'line',
    data:{labels:Object.keys(map),datasets:[{data:Object.values(map),borderColor:'#27B2A5',pointRadius:4,tension:.4}]},
    options:{plugins:{legend:{display:false}},scales:{x:{display:true},y:{display:false}}}
  });
}

function renderGoalStatus(){
  goalStatus.innerHTML='';
  const now=new Date();
  for(let m=0;m<4;m++){
    const key=`2026-${String(m+1).padStart(2,'0')}`;
    const total=records.filter(r=>r.date.startsWith(key)).reduce((a,b)=>a+b.calorie,0);
    let icon='';
    if(total>=6000) icon='âœ…';
    else{
      const nowKey=`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
      if(key===nowKey) icon='â³';
      else if(key<nowKey) icon='âŒ';
    }
    const div=document.createElement('div');
    div.innerHTML=`<div>${m+1}ì›”</div><div class="goal-icon">${icon}</div>`;
    goalStatus.appendChild(div);
  }
}

render();
</script>
</body>
</html>
