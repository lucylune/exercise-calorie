<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸƒâ€â™‚ï¸ Burnning ğŸ”¥</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --main:#27B2A5;
      --accent:#FF6363;
      --bg:#D4F0ED;
      --sub:#FFC1C1;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:'Nanum Myeongjo', serif;
      background:var(--bg);
      color:#222;
    }

    header{
      padding:14px;
      background:var(--main);
      color:white;
      text-align:center;
      font-size:18px;
      font-weight:700;
    }

    .container{ padding:12px; }

    .card{
      background:white;
      border-radius:16px;
      padding:14px;
      margin-bottom:14px;
      box-shadow:0 6px 14px rgba(0,0,0,0.06);
    }

    h1{ margin:4px 0 8px; font-size:22px; }
    h2{ margin:0 0 8px; font-size:15px; }

    button{
      width:100%;
      padding:12px;
      border:none;
      border-radius:12px;
      background:var(--main);
      color:white;
      font-size:15px;
      font-weight:700;
      cursor:pointer;
    }

    button.small{
      width:36px;
      height:36px;
      padding:0;
      font-size:14px;
    }

    input, select{
      width:100%;
      padding:10px;
      margin-top:6px;
      font-size:15px;
      border-radius:10px;
      border:1px solid #ddd;
    }

    .summary-bar{
      display:flex;
      height:10px;
      border-radius:6px;
      overflow:hidden;
      margin-top:6px;
    }

    .legend{
      display:flex;
      flex-wrap:wrap;
      gap:6px 10px;
      margin-top:8px;
      font-size:12px;
    }

    .legend span{ display:flex; align-items:center; gap:4px; }

    .dot{
      width:10px;
      height:10px;
      border-radius:50%;
      display:inline-block;
    }

    .calendar-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:8px;
    }

    .calendar{
      display:grid;
      grid-template-columns:repeat(7,1fr);
      gap:6px;
    }

    .day{
      border:1px solid #ddd;
      border-radius:10px;
      padding:6px 2px;
      font-size:12px;
      text-align:center;
      cursor:pointer;
      background:#fafafa;
    }

    .day:hover{ background:var(--bg); }

    .kcal{ font-size:11px; color:var(--main); }

    canvas{ max-height:110px; }

    .detail-item{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:8px;
      font-size:14px;
    }

    .delete{
      background:var(--accent);
      padding:4px 8px;
      border-radius:6px;
      font-size:11px;
      color:white;
      border:none;
      width:auto;
    }

    .page{ display:none; }
    .page.active{ display:block; }

  </style>
</head>
<body>

<header id="headerTitle">ğŸƒâ€â™‚ï¸ Burnning ğŸ”¥</header>

<div class="container">

  <!-- MAIN PAGE -->
  <div id="mainPage" class="page active">

    <div class="card">
      <h2 id="monthTitle"></h2>
      <h1 id="monthTotal">0 kcal</h1>
      <div class="summary-bar" id="summaryBar"></div>
      <div class="legend" id="legend"></div>
    </div>

    <div class="card">
      <button id="toggleBtn">ìš´ë™ ê¸°ë¡í•˜ê¸°</button>
      <div id="form" style="display:none; margin-top:10px;">
        <input type="date" id="date" />
        <select id="exercise">
          <option value="">ìš´ë™ ì„ íƒ</option>
          <option>ìˆ˜ì˜</option>
          <option>ë‹¬ë¦¬ê¸°</option>
          <option>ëŸ°ë‹ë¨¸ì‹ </option>
          <option>ê±·ê¸°</option>
          <option>ì›¨ì´íŠ¸ íŠ¸ë ˆì´ë‹</option>
        </select>
        <input type="number" id="calorie" placeholder="ì¹¼ë¡œë¦¬ (kcal)" />
        <input type="number" id="time" placeholder="ìš´ë™ ì‹œê°„ (ë¶„)" />
        <button id="addBtn" style="margin-top:8px">ê¸°ë¡ ì¶”ê°€</button>
        <p id="msg" style="color:var(--accent)"></p>
      </div>
    </div>

    <div class="card">
      <h2>ë‚ ì§œë³„ë¡œ ë³´ê¸°</h2>
      <div class="calendar-header">
        <button class="small" id="prevMonth">â—€</button>
        <strong id="calMonth"></strong>
        <button class="small" id="nextMonth">â–¶</button>
      </div>
      <div class="calendar" id="calendar"></div>
    </div>

    <div class="card">
      <h2>ì¢…ëª©ë³„ë¡œ ë³´ê¸°</h2>
      <canvas id="lineChart"></canvas>
    </div>

  </div>

  <!-- DETAIL PAGE -->
  <div id="detailPage" class="page">
    <button id="backBtn" class="small" style="margin-bottom:10px">â†</button>
    <div class="card" id="detail"></div>
  </div>

</div>

<script>
const mainPage=document.getElementById('mainPage');
const detailPage=document.getElementById('detailPage');
const headerTitle=document.getElementById('headerTitle');

const form=document.getElementById('form');
const toggleBtn=document.getElementById('toggleBtn');
const addBtn=document.getElementById('addBtn');
const dateInput=document.getElementById('date');
const exerciseInput=document.getElementById('exercise');
const calorieInput=document.getElementById('calorie');
const timeInput=document.getElementById('time');
const msg=document.getElementById('msg');

const monthTitle=document.getElementById('monthTitle');
const monthTotal=document.getElementById('monthTotal');
const summaryBar=document.getElementById('summaryBar');
const legend=document.getElementById('legend');
const calendar=document.getElementById('calendar');
const calMonth=document.getElementById('calMonth');
const detail=document.getElementById('detail');
const backBtn=document.getElementById('backBtn');

const colors={
  ìˆ˜ì˜:'#27B2A5',
  ë‹¬ë¦¬ê¸°:'#FF6363',
  ëŸ°ë‹ë¨¸ì‹ :'#D4F0ED',
  ê±·ê¸°:'#FFC1C1',
  'ì›¨ì´íŠ¸ íŠ¸ë ˆì´ë‹':'#f59e0b'
};

let records=JSON.parse(localStorage.getItem('exerciseRecords')||'[]');
let viewDate=new Date();
let lineChart;

toggleBtn.onclick=()=>{
  form.style.display=form.style.display==='none'?'block':'none';
};

addBtn.onclick=()=>{
  if(!dateInput.value||!exerciseInput.value||!calorieInput.value||!timeInput.value){
    msg.innerText='ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”'; return;
  }
  records.push({
    date:dateInput.value,
    exercise:exerciseInput.value,
    calorie:+calorieInput.value,
    time:+timeInput.value
  });
  localStorage.setItem('exerciseRecords',JSON.stringify(records));
  msg.innerText='';
  form.style.display='none';
  render();
};

prevMonth.onclick=()=>{ viewDate.setMonth(viewDate.getMonth()-1); render(); };
nextMonth.onclick=()=>{ viewDate.setMonth(viewDate.getMonth()+1); render(); };

function render(){
  const y=viewDate.getFullYear();
  const m=viewDate.getMonth();
  const key=`${y}-${String(m+1).padStart(2,'0')}`;

  monthTitle.innerText=`${m+1}ì›” ì´ ìš´ë™ ì¹¼ë¡œë¦¬`;
  calMonth.innerText=`${y}.${m+1}`;

  let total=0,map={},dayMap={};

  records.forEach(r=>{
    if(r.date.startsWith(key)){
      total+=r.calorie;
      map[r.exercise]=(map[r.exercise]||0)+r.calorie;
      dayMap[r.date]=(dayMap[r.date]||0)+r.calorie;
    }
  });

  monthTotal.innerText=total+' kcal';

  summaryBar.innerHTML=''; legend.innerHTML='';
  Object.keys(map).forEach(k=>{
    const bar=document.createElement('div');
    bar.style.width=total?(map[k]/total*100)+'%':'0%';
    bar.style.background=colors[k];
    summaryBar.appendChild(bar);
    legend.innerHTML+=`<span><i class="dot" style="background:${colors[k]}"></i>${k} ${map[k]}kcal</span>`;
  });

  calendar.innerHTML='';
  const days=new Date(y,m+1,0).getDate();
  for(let i=1;i<=days;i++){
    const d=`${key}-${String(i).padStart(2,'0')}`;
    const div=document.createElement('div');
    div.className='day';
    div.innerHTML=`${i}<br><span class="kcal">${dayMap[d]||''}</span>`;
    div.onclick=()=>openDetail(d);
    calendar.appendChild(div);
  }

  drawLine(map);
}

function openDetail(date){
  mainPage.classList.remove('active');
  detailPage.classList.add('active');
  headerTitle.innerText='ìš´ë™ ìƒì„¸';

  detail.innerHTML=`<h2>${date}</h2>`;
  records.map((r,i)=>({...r,i}))
    .filter(r=>r.date===date)
    .forEach(r=>{
      const div=document.createElement('div');
      div.className='detail-item';
      div.innerHTML=`${r.exercise} ${r.calorie}kcal`;
      const del=document.createElement('button');
      del.className='delete'; del.innerText='ì‚­ì œ';
      del.onclick=()=>removeRecord(r.i);
      div.appendChild(del);
      detail.appendChild(div);
    });
}

backBtn.onclick=()=>{
  detailPage.classList.remove('active');
  mainPage.classList.add('active');
  headerTitle.innerText='ğŸƒâ€â™‚ï¸ Burnning ğŸ”¥';
};

function removeRecord(i){
  records.splice(i,1);
  localStorage.setItem('exerciseRecords',JSON.stringify(records));
  backBtn.click(); render();
}

function drawLine(map){
  const ctx=document.getElementById('lineChart');
  if(lineChart) lineChart.destroy();
  lineChart=new Chart(ctx,{
    type:'line',
    data:{
      labels:Object.keys(map),
      datasets:[{
        data:Object.values(map),
        borderColor:'#27B2A5',
        pointRadius:4,
        pointBackgroundColor:'#FF6363',
        tension:0.3
      }]
    },
    options:{
      scales:{ x:{ display:true }, y:{ display:false } },
      plugins:{ legend:{ display:false }, tooltip:{ enabled:false } },
      animation:false
    },
    plugins:[{
      afterDatasetsDraw(chart){
        const ctx=chart.ctx;
        ctx.save();
        chart.data.datasets[0].data.forEach((v,i)=>{
          const p=chart.getDatasetMeta(0).data[i];
          ctx.fillStyle='#333';
          ctx.font='10px serif';
          ctx.fillText(v+'kcal',p.x-14,p.y-8);
        });
      }
    }]
  });
}

render();
</script>
</body>
</html>
