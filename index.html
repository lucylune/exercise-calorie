<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸƒâ€â™‚ï¸ MH Burning ğŸ”¥</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&display=swap">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{
      --main:#27B2A5;--accent:#FF6363;--bg:#D4F0ED;--sub:#FFC1C1;--text:#7F7F7F;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Nanum Gothic',sans-serif;background:var(--bg);color:var(--text)}
    header{background:var(--main);color:#fff;text-align:center;padding:14px;font-size:18px;font-weight:700}
    .container{padding:12px}
    .card{background:#fff;border-radius:16px;padding:14px;margin-bottom:14px;box-shadow:0 6px 14px rgba(0,0,0,.06)}
    h1{margin:4px 0 6px;font-size:22px}
    h2{margin:0 0 8px;font-size:15px}
    .summary-bar{display:flex;height:10px;border-radius:6px;overflow:hidden;margin-top:6px}
    .legend{display:flex;flex-wrap:wrap;gap:6px 10px;margin-top:8px;font-size:12px}
    .dot{width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:4px}
    .goal-text{margin-top:14px;font-size:18px;font-weight:700}
    .btn{width:100%;padding:12px;border:none;border-radius:12px;background:var(--accent);color:#fff;font-size:15px;font-weight:700;margin-bottom:14px}
    .month-nav{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .nav-btn{padding:4px 8px;border-radius:6px;background:var(--main);color:#fff;font-size:12px;cursor:pointer}
    .calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .day{border:1px solid #ddd;border-radius:10px;padding:6px 2px;font-size:12px;text-align:center;cursor:pointer}
    .kcal{font-size:11px;color:var(--main)}
    canvas{max-height:120px}
    .goal-row{display:flex;justify-content:space-around;text-align:center}
    .goal-icon{font-size:14px;margin-top:4px}
    .hidden{display:none}
    input,select{width:100%;padding:8px;margin-bottom:8px}
  </style>
</head>
<body>
<header>ğŸƒâ€â™‚ï¸ MH Burning ğŸ”¥</header>
<div class="container">

  <div class="card">
    <h2 id="monthTitle"></h2>
    <h1 id="monthTotal"></h1>
    <div class="summary-bar" id="summaryBar"></div>
    <div class="legend" id="legend"></div>
    <div class="goal-text" id="goalText"></div>
  </div>

  <button class="btn" onclick="toggleForm()">ìš´ë™ ê¸°ë¡í•˜ê¸°</button>

  <div class="card hidden" id="formCard">
    <h2>ìš´ë™ ê¸°ë¡</h2>
    <input type="date" id="fDate" />
    <select id="fType">
      <option>ìˆ˜ì˜</option><option>ë‹¬ë¦¬ê¸°</option><option>ëŸ°ë‹ë¨¸ì‹ </option><option>ê±·ê¸°</option><option>ì›¨ì´íŠ¸ íŠ¸ë ˆì´ë‹</option>
    </select>
    <input type="number" id="fCal" placeholder="ì¹¼ë¡œë¦¬ (kcal)" />
    <input type="number" id="fTime" placeholder="ìš´ë™ ì‹œê°„ (ë¶„)" />
    <button class="btn" onclick="addRecord()">ê¸°ë¡ ì¶”ê°€</button>
  </div>

  <div class="card">
    <h2>ë‚ ì§œë³„ë¡œ ë³´ê¸°</h2>
    <div class="month-nav">
      <span class="nav-btn" onclick="changeCalMonth(-1)">â—€</span>
      <span id="calMonth"></span>
      <span class="nav-btn" onclick="changeCalMonth(1)">â–¶</span>
    </div>
    <div class="calendar" id="calendar"></div>
  </div>

  <div class="card">
    <h2>ì¢…ëª©ë³„ë¡œ ë³´ê¸°</h2>
    <div class="month-nav">
      <span class="nav-btn" onclick="changeChartMonth(-1)">â—€</span>
      <span id="chartMonth"></span>
      <span class="nav-btn" onclick="changeChartMonth(1)">â–¶</span>
    </div>
    <canvas id="lineChart"></canvas>
  </div>

  <div class="card">
    <h2>ëª©í‘œ ë‹¬ì„± í˜„í™©</h2>
    <div class="goal-row" id="goalStatus"></div>
  </div>

</div>

<script>
let records=JSON.parse(localStorage.getItem('exerciseRecords')||'[]');
const colors={ìˆ˜ì˜:'#27B2A5',ë‹¬ë¦¬ê¸°:'#FF6363',ëŸ°ë‹ë¨¸ì‹ :'#D4F0ED',ê±·ê¸°:'#FFC1C1','ì›¨ì´íŠ¸ íŠ¸ë ˆì´ë‹':'#999'};
let calDate=new Date();
let chartDate=new Date();
let chart;

function toggleForm(){document.getElementById('formCard').classList.toggle('hidden')}

function addRecord(){
  if(!fDate.value||!fCal.value) return alert('ë‚ ì§œì™€ ì¹¼ë¡œë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
  records.push({id:Date.now(),date:fDate.value,exercise:fType.value,calorie:+fCal.value,time:+fTime.value});
  localStorage.setItem('exerciseRecords',JSON.stringify(records));
  toggleForm(); renderAll();
}

function changeCalMonth(d){calDate.setMonth(calDate.getMonth()+d);renderCalendar()}
function changeChartMonth(d){chartDate.setMonth(chartDate.getMonth()+d);renderChart()}

function renderSummary(){
  const now=new Date();const y=now.getFullYear(),m=now.getMonth();
  const key=`${y}-${String(m+1).padStart(2,'0')}`;
  monthTitle.innerText=`${m+1}ì›” ì´ ìš´ë™ ì¹¼ë¡œë¦¬`;
  let total=0,map={};
  records.forEach(r=>{if(r.date.startsWith(key)){total+=r.calorie;map[r.exercise]=(map[r.exercise]||0)+r.calorie}});
  monthTotal.innerText=total+' kcal';
  summaryBar.innerHTML='';legend.innerHTML='';
  Object.keys(map).forEach(k=>{const bar=document.createElement('div');bar.style.width=(map[k]/total*100)+'%';bar.style.background=colors[k];summaryBar.appendChild(bar);legend.innerHTML+=`<span><i class="dot" style="background:${colors[k]}"></i>${k} ${map[k]}kcal</span>`});
  const diff=6000-total;
  goalText.innerHTML=diff>0
    ? `6,000kcal ë‹¬ì„±ê¹Œì§€ <span style="color:#FF6363">${diff}kcal</span> ë‚¨ì•˜ì–´ìš”!`
    : `ì§ì§ì§! <span style="color:#01888C">${-diff}kcal</span> ë” íƒœì› ì–´ìš” ğŸ‰`;
}

function renderCalendar(){
  const y=calDate.getFullYear(),m=calDate.getMonth();
  const key=`${y}-${String(m+1).padStart(2,'0')}`;
  calMonth.innerText=`${m+1}ì›”`;
  let dayMap={};
  records.forEach(r=>{if(r.date.startsWith(key))dayMap[r.date]=(dayMap[r.date]||0)+r.calorie});
  calendar.innerHTML='';
  const days=new Date(y,m+1,0).getDate();
  for(let i=1;i<=days;i++){const d=`${key}-${String(i).padStart(2,'0')}`;calendar.innerHTML+=`<div class="day">${i}<br><span class="kcal">${dayMap[d]||''}</span></div>`}
}

function renderChart(){
  const y=chartDate.getFullYear(),m=chartDate.getMonth();
  chartMonth.innerText=`${m+1}ì›”`;
  const key=`${y}-${String(m+1).padStart(2,'0')}`;
  let map={};records.forEach(r=>{if(r.date.startsWith(key))map[r.exercise]=(map[r.exercise]||0)+r.calorie});
  if(chart) chart.destroy();
  chart=new Chart(lineChart,{type:'line',data:{labels:Object.keys(map),datasets:[{data:Object.values(map),borderColor:'#27B2A5',pointRadius:4,tension:.4}]},options:{plugins:{legend:{display:false}},scales:{y:{display:false}}}});
}

function renderGoalStatus(){
  goalStatus.innerHTML='';const now=new Date();
  for(let i=0;i<4;i++){
    const key=`2026-${String(i+1).padStart(2,'0')}`;
    const total=records.filter(r=>r.date.startsWith(key)).reduce((a,b)=>a+b.calorie,0);
    let icon='';
    const nowKey=`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
    if(key===nowKey) icon='â³'; else if(key<nowKey) icon=total>=6000?'âœ…':'âŒ';
    goalStatus.innerHTML+=`<div><div>${i+1}ì›”</div><div class="goal-icon">${icon}</div></div>`;
  }
}

function renderAll(){renderSummary();renderCalendar();renderChart();renderGoalStatus()}
renderAll();
</script>
</body>
</html>
