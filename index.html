<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸƒâ€â™‚ï¸ Burning ğŸ”¥</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{--main:#27B2A5;--accent:#FF6363;--bg:#D4F0ED;--sub:#FFC1C1}
    *{box-sizing:border-box}
    body{margin:0;font-family:'Nanum Gothic',system-ui,sans-serif;background:var(--bg);color:#7F7F7F}
    header{padding:14px;background:var(--main);color:#fff;text-align:center;font-weight:700}
    .container{padding:12px}
    .card{background:#fff;border-radius:16px;padding:14px;margin-bottom:14px;box-shadow:0 6px 14px rgba(0,0,0,.06)}
    h1{margin:4px 0 8px;font-size:22px}
    h2{margin:0 0 8px;font-size:15px}
    .summary-bar{display:flex;height:10px;border-radius:6px;overflow:hidden;margin-top:6px}
    .legend{display:flex;flex-wrap:wrap;gap:6px 10px;margin-top:8px;font-size:12px}
    .dot{width:10px;height:10px;border-radius:50%;display:inline-block}
    .btn{display:block;width:100%;padding:12px;border:none;border-radius:12px;background:var(--accent);color:#fff;font-size:15px;font-weight:700;margin-bottom:14px}
    .calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .day{border:1px solid #ddd;border-radius:10px;padding:6px 2px;font-size:12px;text-align:center;cursor:pointer}
    .kcal{font-size:11px;color:var(--main)}
    .month-nav{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .nav-btn{padding:4px 8px;border-radius:6px;background:var(--main);color:#fff;font-size:12px;cursor:pointer}
    canvas{max-height:120px}
    .goal-row{display:flex;justify-content:space-around;text-align:center}
    .goal-icon{font-size:14px;margin-top:4px}
  </style>
</head>
<body>
<header>ğŸƒâ€â™‚ï¸ Burning ğŸ”¥</header>
<div class="container">

  <div class="card">
    <h2 id="monthTitle"></h2>
    <h1 id="monthTotal"></h1>
    <div class="summary-bar" id="summaryBar"></div>
    <div class="legend" id="legend"></div>
    <p id="goalText" style="margin-top:14px;font-size:16px;font-weight:700"></p>
  </div>

  <button class="btn" onclick="openForm()">ìš´ë™ ê¸°ë¡í•˜ê¸°</button>

  <div class="card">
    <h2>ë‚ ì§œë³„ë¡œ ë³´ê¸°</h2>
    <div class="month-nav">
      <span class="nav-btn" onclick="changeMonth(-1)">â—€</span>
      <span id="calMonth"></span>
      <span class="nav-btn" onclick="changeMonth(1)">â–¶</span>
    </div>
    <div class="calendar" id="calendar"></div>
  </div>

  <div class="card">
    <h2>ì¢…ëª©ë³„ë¡œ ë³´ê¸°</h2>
    <canvas id="lineChart"></canvas>
  </div>

  <div class="card">
    <h2>ëª©í‘œ ë‹¬ì„± í˜„í™©</h2>
    <div class="goal-row" id="goalStatus"></div>
  </div>
</div>

<script>
function openForm(){alert('ìš´ë™ ê¸°ë¡ í¼ í˜ì´ì§€ ì—°ê²° ì˜ˆì •');}
function openDetail(date){alert(date+' ìƒì„¸ í˜ì´ì§€ ì—°ê²° ì˜ˆì •');}

const records = JSON.parse(localStorage.getItem('exerciseRecords') || '[]');
const monthTitle = document.getElementById('monthTitle');
const monthTotal = document.getElementById('monthTotal');
const summaryBar = document.getElementById('summaryBar');
const legend = document.getElementById('legend');
const calendar = document.getElementById('calendar');
const goalText = document.getElementById('goalText');
const goalStatus = document.getElementById('goalStatus');
const calMonth = document.getElementById('calMonth');
let viewDate = new Date();
const colors = {ìˆ˜ì˜:'#27B2A5',ë‹¬ë¦¬ê¸°:'#FF6363',ëŸ°ë‹ë¨¸ì‹ :'#D4F0ED',ê±·ê¸°:'#FFC1C1','ì›¨ì´íŠ¸ íŠ¸ë ˆì´ë‹':'#f59e0b'};
let chart;

function changeMonth(diff){
  viewDate.setMonth(viewDate.getMonth() + diff);
  render();
}

function render(){
  const y = viewDate.getFullYear();
  const m = viewDate.getMonth();
  const key = `${y}-${String(m+1).padStart(2,'0')}`;
  calMonth.innerText = `${m+1}ì›”`;

  let total = 0;
  let map = {};
  let dayMap = {};

  records.forEach(r => {
    if(r.date.startsWith(key)){
      total += r.calorie;
      map[r.exercise] = (map[r.exercise] || 0) + r.calorie;
      dayMap[r.date] = (dayMap[r.date] || 0) + r.calorie;
    }
  });

  monthTitle.innerText = `${m+1}ì›” ì´ ìš´ë™ ì¹¼ë¡œë¦¬`;
  monthTotal.innerText = total + ' kcal';

  const diff = 6000 - total;
  if(diff > 0){
    goalText.innerHTML = `6,000kcal ë‹¬ì„±ê¹Œì§€ <span style="color:#FF6363">${diff}kcal</span> ë‚¨ì•˜ì–´ìš”!`;
  } else {
    goalText.innerHTML = `ì§ì§ì§! <span style="color:#01888C">${Math.abs(diff)}kcal</span> ë” íƒœì› ì–´ìš” ğŸ‰`;
  }

  summaryBar.innerHTML = '';
  legend.innerHTML = '';
  Object.keys(map).forEach(k => {
    const bar = document.createElement('div');
    bar.style.width = total ? (map[k] / total * 100) + '%' : '0%';
    bar.style.background = colors[k];
    summaryBar.appendChild(bar);
    legend.innerHTML += `<span><i class="dot" style="background:${colors[k]}"></i>${k} ${map[k]}kcal</span>`;
  });

  calendar.innerHTML = '';
  const days = new Date(y, m+1, 0).getDate();
  for(let i=1;i<=days;i++){
    const d = `${key}-${String(i).padStart(2,'0')}`;
    calendar.innerHTML += `<div class="day" onclick="openDetail('${d}')">${i}<br><span class="kcal">${dayMap[d] || ''}</span></div>`;
  }

  renderChart(map);
  renderGoalStatus();
}

function renderChart(map){
  const ctx = document.getElementById('lineChart');
  if(chart) chart.destroy();
  chart = new Chart(ctx, {
    type:'line',
    data:{
      labels:Object.keys(map),
      datasets:[{
        data:Object.values(map),
        borderColor:'#27B2A5',
        pointRadius:4,
        tension:0.4
      }]
    },
    options:{
      plugins:{legend:{display:false}},
      scales:{x:{display:true},y:{display:false}}
    }
  });
}

function renderGoalStatus(){
  goalStatus.innerHTML = '';
  const now = new Date();
  const nowKey = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;

  for(let m=0;m<4;m++){
    const key = `2026-${String(m+1).padStart(2,'0')}`;
    const total = records
      .filter(r => r.date.startsWith(key))
      .reduce((a,b) => a + b.calorie, 0);

    let icon = '';
    if(key === nowKey) icon = 'â³';
    else if(key < nowKey) icon = total >= 6000 ? 'âœ…' : 'âŒ';

    const div = document.createElement('div');
    div.innerHTML = `<div>${m+1}ì›”</div><div class="goal-icon">${icon}</div>`;
    goalStatus.appendChild(div);
  }
}

render();
</script>
</body>
</html>
