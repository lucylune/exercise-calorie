<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸƒâ€â™‚ï¸ Burning ğŸ”¥</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --main:#27B2A5;
      --accent:#FF6363;
      --bg:#D4F0ED;
      --sub:#FFC1C1;
      --text:#7F7F7F;
    }
    *{box-sizing:border-box;}
    body{margin:0;font-family:'Nanum Gothic',sans-serif;background:var(--bg);color:var(--text);}    
    header{padding:14px;background:var(--main);color:#fff;text-align:center;font-weight:700;}
    .container{padding:12px;}
    .card{background:#fff;border-radius:16px;padding:14px;margin-bottom:14px;box-shadow:0 6px 14px rgba(0,0,0,.06);}    
    h1{margin:4px 0;font-size:22px;color:#333;}
    h2{margin:0 0 10px;font-size:15px;color:#333;}
    button{background:var(--main);color:#fff;border:none;border-radius:10px;padding:10px;font-size:14px;}
    button.small{padding:6px 10px;font-size:12px;width:auto;}
    .summary-bar{display:flex;height:10px;border-radius:6px;overflow:hidden;margin-top:6px;}
    .legend{display:flex;flex-wrap:wrap;gap:6px 10px;margin-top:8px;font-size:12px;}
    .dot{width:10px;height:10px;border-radius:50%;display:inline-block;}
    .calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;}
    .day{border:1px solid #ddd;border-radius:10px;padding:6px 2px;font-size:12px;text-align:center;cursor:pointer;}
    .kcal{font-size:11px;color:var(--main);}    
    .nav{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;}
    .goal-status{display:flex;justify-content:space-between;text-align:center;}
    .goal-item{flex:1;}
    .hidden{display:none;}
  </style>
</head>
<body>
<header>ğŸƒâ€â™‚ï¸ Burning ğŸ”¥</header>
<div class="container">

  <!-- ë©”ì¸ -->
  <div class="card" id="mainPage">
    <h2 id="monthTitle"></h2>
    <h1 id="monthTotal"></h1>
    <div class="summary-bar" id="summaryBar"></div>
    <div class="legend" id="legend"></div>
    <p id="goalText" style="margin-top:14px;font-size:16px;font-weight:700"></p>

    <!-- ê¸°ë¡ -->
    <button onclick="toggleForm()">ìš´ë™ ê¸°ë¡í•˜ê¸°</button>
    <div id="form" class="hidden">
      <input type="date" id="date"><br>
      <select id="exercise">
        <option>ìˆ˜ì˜</option><option>ë‹¬ë¦¬ê¸°</option><option>ëŸ°ë‹ë¨¸ì‹ </option><option>ê±·ê¸°</option><option>ì›¨ì´íŠ¸ íŠ¸ë ˆì´ë‹</option>
      </select><br>
      <input type="number" id="calorie" placeholder="ì¹¼ë¡œë¦¬ (kcal)"><br>
      <input type="number" id="time" placeholder="ìš´ë™ ì‹œê°„ (ë¶„)"><br>
      <button onclick="addRecord()">ê¸°ë¡ ì¶”ê°€</button>
    </div>
  </div>

  <!-- ë‚ ì§œë³„ -->
  <div class="card" id="calendarPage">
    <div class="nav">
      <button class="small" onclick="changeMonth(-1)">â—€</button>
      <h2>ë‚ ì§œë³„ë¡œ ë³´ê¸°</h2>
      <button class="small" onclick="changeMonth(1)">â–¶</button>
    </div>
    <div class="calendar" id="calendar"></div>
  </div>

  <!-- ì¢…ëª©ë³„ -->
  <div class="card">
    <h2>ì¢…ëª©ë³„ë¡œ ë³´ê¸°</h2>
    <canvas id="lineChart" height="120"></canvas>
  </div>

  <!-- ëª©í‘œ -->
  <div class="card">
    <h2>ëª©í‘œ ë‹¬ì„± í˜„í™©</h2>
    <div class="goal-status" id="goalStatus"></div>
  </div>

  <!-- ìƒì„¸ -->
  <div class="card hidden" id="detailPage">
    <button class="small" onclick="backToMain()">â† ëŒì•„ê°€ê¸°</button>
    <h2 id="detailTitle"></h2>
    <div id="detailList"></div>
  </div>

</div>

<script>
const records=JSON.parse(localStorage.getItem('exerciseRecords')||'[]');
const colors={ìˆ˜ì˜:'#27B2A5',ë‹¬ë¦¬ê¸°:'#FF6363',ëŸ°ë‹ë¨¸ì‹ :'#D4F0ED',ê±·ê¸°:'#FFC1C1','ì›¨ì´íŠ¸ íŠ¸ë ˆì´ë‹':'#f59e0b'};
let viewDate=new Date();let chart;

function toggleForm(){document.getElementById('form').classList.toggle('hidden');}

function addRecord(){
  const d=date.value,e=exercise.value,c=+calorie.value,t=+time.value;
  if(!d||!c||!t) return alert('ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”');
  records.push({date:d,exercise:e,calorie:c,time:t});
  localStorage.setItem('exerciseRecords',JSON.stringify(records));
  render();
}

function changeMonth(diff){viewDate.setMonth(viewDate.getMonth()+diff);render();}

function openDetail(date){
  document.getElementById('mainPage').classList.add('hidden');
  document.getElementById('calendarPage').classList.add('hidden');
  document.getElementById('detailPage').classList.remove('hidden');
  detailTitle.innerText=date;
  detailList.innerHTML='';
  records.filter(r=>r.date===date).forEach((r,i)=>{
    const div=document.createElement('div');
    div.innerHTML=`${r.exercise} ${r.calorie}kcal <button class="small" onclick="deleteRecord('${date}',${i})">ì‚­ì œ</button>`;
    detailList.appendChild(div);
  });
}

function deleteRecord(date,index){
  const list=records.filter(r=>r.date===date);
  const target=list[index];
  const idx=records.indexOf(target);
  records.splice(idx,1);
  localStorage.setItem('exerciseRecords',JSON.stringify(records));
  openDetail(date);render();
}

function backToMain(){
  detailPage.classList.add('hidden');
  mainPage.classList.remove('hidden');
  calendarPage.classList.remove('hidden');
}

function render(){
  const y=viewDate.getFullYear(),m=viewDate.getMonth();
  const key=`${y}-${String(m+1).padStart(2,'0')}`;
  let total=0,map={},dayMap={};
  records.forEach(r=>{if(r.date.startsWith(key)){total+=r.calorie;map[r.exercise]=(map[r.exercise]||0)+r.calorie;dayMap[r.date]=(dayMap[r.date]||0)+r.calorie;}});
  monthTitle.innerText=`${m+1}ì›” ì´ ìš´ë™ ì¹¼ë¡œë¦¬`;monthTotal.innerText=total+' kcal';
  const diff=6000-total;
  goalText.innerHTML=diff>0?`6,000kcal ë‹¬ì„±ê¹Œì§€ <span style='color:var(--accent)'>${diff}kcal</span> ë‚¨ì•˜ì–´ìš”!`:`ì§ì§ì§! <span style='color:#01888C'>${Math.abs(diff)}kcal</span> ë” íƒœì› ì–´ìš” ğŸ‰`;

  summaryBar.innerHTML='';legend.innerHTML='';
  Object.keys(map).forEach(k=>{const b=document.createElement('div');b.style.width=(map[k]/total*100||0)+'%';b.style.background=colors[k];summaryBar.appendChild(b);legend.innerHTML+=`<span><i class='dot' style='background:${colors[k]}'></i>${k} ${map[k]}kcal</span>`});

  if(chart) chart.destroy();
  chart=new Chart(lineChart,{type:'line',data:{labels:Object.keys(map),datasets:[{data:Object.values(map),borderColor:'#27B2A5',pointRadius:4}]},options:{plugins:{legend:{display:false}},scales:{y:{display:false}}}});

  calendar.innerHTML='';const days=new Date(y,m+1,0).getDate();
  for(let i=1;i<=days;i++){const d=`${key}-${String(i).padStart(2,'0')}`;calendar.innerHTML+=`<div class='day' onclick="openDetail('${d}')">${i}<br><span class='kcal'>${dayMap[d]||''}</span></div>`;}
}

render();
</script>
</body>
</html>
