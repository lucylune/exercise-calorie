<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸƒâ€â™‚ï¸ Burning ğŸ”¥</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --main:#27B2A5;
      --accent:#FF6363;
      --bg:#D4F0ED;
      --sub:#FFC1C1;
    }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family:'Nanum Gothic',system-ui,sans-serif; background:var(--bg); }
    header{ padding:14px; background:var(--main); color:white; text-align:center; font-weight:700; }
    .container{ padding:12px; }
    .card{ background:white; border-radius:16px; padding:14px; margin-bottom:14px; box-shadow:0 6px 14px rgba(0,0,0,.06); }
    h1{ margin:4px 0 8px; font-size:22px; }
    h2{ margin:0 0 8px; font-size:15px; }
    .summary-bar{ display:flex; height:10px; border-radius:6px; overflow:hidden; margin-top:6px; }
    .legend{ display:flex; flex-wrap:wrap; gap:6px 10px; margin-top:8px; font-size:12px; }
    .dot{ width:10px; height:10px; border-radius:50%; display:inline-block; }
    .calendar{ display:grid; grid-template-columns:repeat(7,1fr); gap:6px; }
    .day{ border:1px solid #ddd; border-radius:10px; padding:6px 2px; font-size:12px; text-align:center; }
    .kcal{ font-size:11px; color:var(--main); }
    canvas{ max-height:110px; }
  </style>
</head>
<body>
<header>ğŸƒâ€â™‚ï¸ Burning ğŸ”¥</header>
<div class="container">

  <div class="card">
    <h2 id="monthTitle"></h2>
    <h1 id="monthTotal"></h1>
    <div class="summary-bar" id="summaryBar"></div>
    <div class="legend" id="legend"></div>
    <p id="goalText" style="margin-top:14px;font-size:16px;font-weight:700;color:#7F7F7F"></p>
  </div>

  <div class="card">
    <h2>ë‚ ì§œë³„ë¡œ ë³´ê¸°</h2>
    <div class="calendar" id="calendar"></div>
  </div>

  <div class="card">
    <h2>ì¢…ëª©ë³„ë¡œ ë³´ê¸°</h2>
    <canvas id="lineChart"></canvas>
  </div>

  <div class="card">
    <h2>ëª©í‘œ ë‹¬ì„± í˜„í™©</h2>
    <div id="goalStatus" style="display:flex;justify-content:space-between;text-align:center"></div>
  </div>

</div>

<script>
const records = JSON.parse(localStorage.getItem('exerciseRecords')||'[]');
const monthTitle=document.getElementById('monthTitle');
const monthTotal=document.getElementById('monthTotal');
const summaryBar=document.getElementById('summaryBar');
const legend=document.getElementById('legend');
const calendar=document.getElementById('calendar');
const goalText=document.getElementById('goalText');
const goalStatus=document.getElementById('goalStatus');

const colors={
  ìˆ˜ì˜:'#27B2A5',
  ë‹¬ë¦¬ê¸°:'#FF6363',
  ëŸ°ë‹ë¨¸ì‹ :'#D4F0ED',
  ê±·ê¸°:'#FFC1C1',
  'ì›¨ì´íŠ¸ íŠ¸ë ˆì´ë‹':'#f59e0b'
};

let viewDate=new Date();

function renderGoalStatus(){
  goalStatus.innerHTML='';
  const now=new Date();
  const nowKey=`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;

  for(let m=0;m<4;m++){
    const key=`2026-${String(m+1).padStart(2,'0')}`;

    const total=records
      .filter(r=>r.date.startsWith(key))
      .reduce((a,b)=>a+b.calorie,0);

    let icon=''; // ê¸°ë³¸ ê³µë€
    if(key === nowKey){
      icon = 'â³'; // ì§„í–‰ì¤‘
    } else if(key < nowKey){
      icon = total>=6000 ? 'âœ…' : 'âŒ';
    }

    const item=document.createElement('div');
    item.innerHTML=`
      <div style="font-size:13px;color:#555">${m+1}ì›”</div>
      <div style="font-size:16px">${icon}</div>
    `;
    goalStatus.appendChild(item);
  }
}

let chart;

function render(){
  const y=viewDate.getFullYear();
  const m=viewDate.getMonth();
  const key=`${y}-${String(m+1).padStart(2,'0')}`;

  let total=0,map={},dayMap={};
  records.forEach(r=>{
    if(r.date.startsWith(key)){
      total+=r.calorie;
      map[r.exercise]=(map[r.exercise]||0)+r.calorie;
      dayMap[r.date]=(dayMap[r.date]||0)+r.calorie;
    }
  });

  monthTitle.innerText=`${m+1}ì›” ì´ ìš´ë™ ì¹¼ë¡œë¦¬`;
  monthTotal.innerText=total+' kcal';

  const diff=total-6000;
  if(diff<0){
    goalText.innerHTML=`6,000kcal ë‹¬ì„±ê¹Œì§€ <span style="color:#FF6363">${Math.abs(diff)}kcal</span> ë‚¨ì•˜ì–´ìš”!`;
  } else {
    goalText.innerHTML=`ì§ì§ì§! <span style="color:#01888C">${diff}kcal</span> ë” íƒœì› ì–´ìš” ğŸ‰`;
  }

  summaryBar.innerHTML='';
  legend.innerHTML='';
  Object.keys(map).forEach(k=>{
    const bar=document.createElement('div');
    bar.style.width=total?(map[k]/total*100)+'%':'0%';
    bar.style.background=colors[k];
    summaryBar.appendChild(bar);
    legend.innerHTML+=`<span><i class="dot" style="background:${colors[k]}"></i>${k} ${map[k]}kcal</span>`;
  });

  // ğŸ“Š ì¢…ëª©ë³„ ê·¸ë˜í”„ ë Œë”ë§
  const ctx=document.getElementById('lineChart');
  if(chart) chart.destroy();
  chart=new Chart(ctx,{
    type:'line',
    data:{
      labels:Object.keys(map),
      datasets:[{
        data:Object.values(map),
        borderColor:'#27B2A5',
        tension:.4,
        fill:false,
        pointRadius:4
      }]
    },
    options:{
      plugins:{legend:{display:false}},
      scales:{x:{display:true},y:{display:false}}
    }
  });

  calendar.innerHTML='';
  const days=new Date(y,m+1,0).getDate();
  for(let i=1;i<=days;i++){
    const d=`${key}-${String(i).padStart(2,'0')}`;
    calendar.innerHTML+=`<div class="day">${i}<br><span class="kcal">${dayMap[d]||''}</span></div>`;
  }

  renderGoalStatus();
}

render();
</script>
</body>
</html>
