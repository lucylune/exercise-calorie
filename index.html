<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ”¥ MH Burning</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,'Apple SD Gothic Neo','Noto Sans KR',sans-serif;background:#D4F0ED;color:#7F7F7F}
    header{background:#27B2A5;color:#fff;padding:14px;text-align:center;font-size:18px;font-weight:700}
    .container{padding:12px}
    .card{background:#fff;border-radius:16px;padding:14px;margin-bottom:14px;box-shadow:0 6px 14px rgba(0,0,0,.06)}
    h2{margin:0 0 8px;font-size:15px}
    h1{margin:0;font-size:22px}
    .summary-bar{display:flex;height:10px;border-radius:6px;overflow:hidden;margin-top:8px}
    .legend{display:flex;flex-wrap:wrap;gap:6px 10px;margin-top:8px;font-size:12px}
    .dot{width:10px;height:10px;border-radius:50%;display:inline-block}
    .btn{width:100%;padding:12px;border:none;border-radius:12px;background:#FF6363;color:#fff;font-weight:700;margin-bottom:14px}
    .month-nav{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .nav-btn{padding:4px 8px;background:#27B2A5;color:#fff;border-radius:6px;font-size:12px;cursor:pointer}
    .calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .day{border:1px solid #ddd;border-radius:10px;padding:6px;font-size:12px;text-align:center;cursor:pointer}
    .kcal{font-size:11px;color:#27B2A5}
    canvas{max-height:140px}
    .goal-row{display:flex;justify-content:space-around;text-align:center}
    .goal-icon{font-size:14px;margin-top:4px}
    .modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center}
    .modal-content{background:#fff;border-radius:14px;padding:16px;width:80%}
    .delete-btn{background:#FF6363;color:#fff;border:none;border-radius:8px;padding:4px 8px;font-size:12px}
  </style>
</head>
<body>
<header>ğŸƒâ€â™‚ï¸ MH Burning ğŸ”¥</header>
<div class="container">

  <div class="card">
    <h2 id="monthTitle"></h2>
    <h1 id="monthTotal"></h1>
    <div class="summary-bar" id="summaryBar"></div>
    <div class="legend" id="legend"></div>
    <p id="goalText" style="margin-top:12px;font-size:14px;font-weight:700"></p>
  </div>

  <button class="btn" onclick="openForm()">ìš´ë™ ê¸°ë¡í•˜ê¸°</button>

  <div class="card">
    <h2>ë‚ ì§œë³„ë¡œ ë³´ê¸°</h2>
    <div class="month-nav">
      <span class="nav-btn" onclick="changeMonth(-1)">â—€</span>
      <span id="calMonth"></span>
      <span class="nav-btn" onclick="changeMonth(1)">â–¶</span>
    </div>
    <div class="calendar" id="calendar"></div>
  </div>

  <div class="card">
    <h2>ì¢…ëª©ë³„ë¡œ ë³´ê¸°</h2>
    <div class="month-nav">
      <span class="nav-btn" onclick="changeMonth(-1)">â—€</span>
      <span id="chartMonth"></span>
      <span class="nav-btn" onclick="changeMonth(1)">â–¶</span>
    </div>
    <canvas id="lineChart"></canvas>
  </div>

  <div class="card">
    <h2>ëª©í‘œ ë‹¬ì„± í˜„í™©</h2>
    <div class="goal-row" id="goalStatus"></div>
  </div>
</div>

<div class="modal" id="detailModal">
  <div class="modal-content">
    <h2 id="detailDate"></h2>
    <div id="detailList"></div>
    <button class="btn" onclick="closeDetail()">ë‹«ê¸°</button>
  </div>
</div>

<script>
const colors={ìˆ˜ì˜:'#27B2A5',ë‹¬ë¦¬ê¸°:'#FF6363',ëŸ°ë‹ë¨¸ì‹ :'#D4F0ED',ê±·ê¸°:'#FFC1C1','ì›¨ì´íŠ¸ íŠ¸ë ˆì´ë‹':'#f59e0b'};
let records=JSON.parse(localStorage.getItem('records')||'[]');
let viewDate=new Date();
let chart;

function save(){localStorage.setItem('records',JSON.stringify(records));}
function openForm(){alert('í¼ì€ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì—°ê²°');}

function changeMonth(diff){viewDate.setMonth(viewDate.getMonth()+diff);render();}

function render(){
  const y=viewDate.getFullYear();
  const m=viewDate.getMonth();
  const key=`${y}-${String(m+1).padStart(2,'0')}`;
  document.getElementById('calMonth').innerText=`${m+1}ì›”`;
  document.getElementById('chartMonth').innerText=`${m+1}ì›”`;

  let total=0,map={},dayMap={};
  records.forEach(r=>{if(r.date.startsWith(key)){total+=r.kcal;map[r.type]=(map[r.type]||0)+r.kcal;dayMap[r.date]=(dayMap[r.date]||0)+r.kcal;}});

  monthTitle.innerText=`${m+1}ì›” ì´ ìš´ë™ ì¹¼ë¡œë¦¬`;
  monthTotal.innerText=`${total} kcal`;

  const diff=6000-total;
  goalText.innerHTML= diff>0
    ? `6,000kcal ë‹¬ì„±ê¹Œì§€ <span style="color:#FF6363">${diff}kcal</span> ë‚¨ì•˜ì–´ìš”!`
    : `ì§ì§ì§! <span style="color:#01888C">${Math.abs(diff)}kcal</span> ë” íƒœì› ì–´ìš”`;

  summaryBar.innerHTML='';legend.innerHTML='';
  Object.keys(map).forEach(k=>{
    const bar=document.createElement('div');
    bar.style.width=total?(map[k]/total*100)+'%':'0%';
    bar.style.background=colors[k];
    summaryBar.appendChild(bar);
    legend.innerHTML+=`<span><i class="dot" style="background:${colors[k]}"></i>${k} ${map[k]}kcal</span>`;
  });

  calendar.innerHTML='';
  const days=new Date(y,m+1,0).getDate();
  for(let i=1;i<=days;i++){
    const d=`${key}-${String(i).padStart(2,'0')}`;
    calendar.innerHTML+=`<div class="day" onclick="openDetail('${d}')">${i}<br><span class="kcal">${dayMap[d]||''}</span></div>`;
  }

  renderChart(map);
  renderGoalStatus();
}

function renderChart(map){
  const ctx=document.getElementById('lineChart');
  if(chart) chart.destroy();
  chart=new Chart(ctx,{type:'line',data:{labels:Object.keys(map),datasets:[{data:Object.values(map),borderColor:'#27B2A5',pointRadius:3,tension:.4}]},options:{plugins:{legend:{display:false}},scales:{y:{display:false}}}});
}

function openDetail(date){
  document.getElementById('detailDate').innerText=date;
  const list=document.getElementById('detailList');
  list.innerHTML='';
  records.filter(r=>r.date===date).forEach(r=>{
    const div=document.createElement('div');
    div.innerHTML=`${r.type} ${r.kcal}kcal <button class="delete-btn" onclick="deleteRecord(${r.id})">ì‚­ì œ</button>`;
    list.appendChild(div);
  });
  document.getElementById('detailModal').style.display='flex';
}

function closeDetail(){document.getElementById('detailModal').style.display='none';}

function deleteRecord(id){records=records.filter(r=>r.id!==id);save();closeDetail();render();}

function renderGoalStatus(){
  const box=document.getElementById('goalStatus');box.innerHTML='';
  const now=new Date();
  for(let i=0;i<4;i++){
    const key=`2026-${String(i+1).padStart(2,'0')}`;
    const total=records.filter(r=>r.date.startsWith(key)).reduce((a,b)=>a+b.kcal,0);
    let icon='';
    const nowKey=`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
    if(key===nowKey) icon='â³';
    else if(key<nowKey) icon=total>=6000?'âœ…':'âŒ';
    box.innerHTML+=`<div><div>${i+1}ì›”</div><div class="goal-icon">${icon}</div></div>`;
  }
}

render();
</script>
</body>
</html>
